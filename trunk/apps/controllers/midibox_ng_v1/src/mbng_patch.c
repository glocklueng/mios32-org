// $Id$
/*
 * Patch Layer for MIDIbox NG
 *
 * ==========================================================================
 *
 *  Copyright (C) 2012 Thorsten Klose (tk@midibox.org)
 *  Licensed for personal non-commercial use only.
 *  All other rights reserved.
 * 
 * ==========================================================================
 */

/////////////////////////////////////////////////////////////////////////////
// Include files
/////////////////////////////////////////////////////////////////////////////

#include <mios32.h>
#include "tasks.h"

#include "mbng_patch.h"
#include "mbng_dout.h"
#include "mbng_file.h"
#include "mbng_file_p.h"


/////////////////////////////////////////////////////////////////////////////
// Preset patch
/////////////////////////////////////////////////////////////////////////////

mbng_patch_din_entry_t  mbng_patch_din[MBNG_PATCH_NUM_DIN] = {
  // ports   mode     ON event           OFF event           SR/Pin
  {  0x1011,  0,   0x90, 0x30, 0x7f,  0x90, 0x30, 0x00 }, // 1.D0
  {  0x1011,  0,   0x90, 0x31, 0x7f,  0x90, 0x31, 0x00 }, // 1.D1
  {  0x1011,  0,   0x90, 0x32, 0x7f,  0x90, 0x32, 0x00 }, // 1.D2
  {  0x1011,  0,   0x90, 0x33, 0x7f,  0x90, 0x33, 0x00 }, // 1.D3
  {  0x1011,  0,   0x90, 0x34, 0x7f,  0x90, 0x34, 0x00 }, // 1.D4
  {  0x1011,  0,   0x90, 0x35, 0x7f,  0x90, 0x35, 0x00 }, // 1.D5
  {  0x1011,  0,   0x90, 0x36, 0x7f,  0x90, 0x36, 0x00 }, // 1.D6
  {  0x1011,  0,   0x90, 0x37, 0x7f,  0x90, 0x37, 0x00 }, // 1.D7

  // ports   mode     ON event           OFF event           SR/Pin
  {  0x1011,  0,   0x90, 0x38, 0x7f,  0x90, 0x38, 0x00 }, // 2.D0
  {  0x1011,  0,   0x90, 0x39, 0x7f,  0x90, 0x39, 0x00 }, // 2.D1
  {  0x1011,  0,   0x90, 0x3a, 0x7f,  0x90, 0x3a, 0x00 }, // 2.D2
  {  0x1011,  0,   0x90, 0x3b, 0x7f,  0x90, 0x3b, 0x00 }, // 2.D3
  {  0x1011,  0,   0x90, 0x3c, 0x7f,  0x90, 0x3c, 0x00 }, // 2.D4
  {  0x1011,  0,   0x90, 0x3d, 0x7f,  0x90, 0x3d, 0x00 }, // 2.D5
  {  0x1011,  0,   0x90, 0x3e, 0x7f,  0x90, 0x3e, 0x00 }, // 2.D6
  {  0x1011,  0,   0x90, 0x3f, 0x7f,  0x90, 0x3f, 0x00 }, // 2.D7

  // ports   mode     ON event           OFF event           SR/Pin
  {  0x1011,  0,   0x90, 0x40, 0x7f,  0x90, 0x40, 0x00 }, // 3.D0
  {  0x1011,  0,   0x90, 0x41, 0x7f,  0x90, 0x41, 0x00 }, // 3.D1
  {  0x1011,  0,   0x90, 0x42, 0x7f,  0x90, 0x42, 0x00 }, // 3.D2
  {  0x1011,  0,   0x90, 0x43, 0x7f,  0x90, 0x43, 0x00 }, // 3.D3
  {  0x1011,  0,   0x90, 0x44, 0x7f,  0x90, 0x44, 0x00 }, // 3.D4
  {  0x1011,  0,   0x90, 0x45, 0x7f,  0x90, 0x45, 0x00 }, // 3.D5
  {  0x1011,  0,   0x90, 0x46, 0x7f,  0x90, 0x46, 0x00 }, // 3.D6
  {  0x1011,  0,   0x90, 0x47, 0x7f,  0x90, 0x47, 0x00 }, // 3.D7

  // ports   mode     ON event           OFF event           SR/Pin
  {  0x1011,  0,   0x90, 0x48, 0x7f,  0x90, 0x48, 0x00 }, // 4.D0
  {  0x1011,  0,   0x90, 0x49, 0x7f,  0x90, 0x49, 0x00 }, // 4.D1
  {  0x1011,  0,   0x90, 0x4a, 0x7f,  0x90, 0x4a, 0x00 }, // 4.D2
  {  0x1011,  0,   0x90, 0x4b, 0x7f,  0x90, 0x4b, 0x00 }, // 4.D3
  {  0x1011,  0,   0x90, 0x4c, 0x7f,  0x90, 0x4c, 0x00 }, // 4.D4
  {  0x1011,  0,   0x90, 0x4d, 0x7f,  0x90, 0x4d, 0x00 }, // 4.D5
  {  0x1011,  0,   0x90, 0x4e, 0x7f,  0x90, 0x4e, 0x00 }, // 4.D6
  {  0x1011,  0,   0x90, 0x4f, 0x7f,  0x90, 0x4f, 0x00 }, // 4.D7

  // ports   mode     ON event           OFF event           SR/Pin
  {  0x1011,  0,   0x90, 0x50, 0x7f,  0x90, 0x50, 0x00 }, // 5.D0
  {  0x1011,  0,   0x90, 0x51, 0x7f,  0x90, 0x51, 0x00 }, // 5.D1
  {  0x1011,  0,   0x90, 0x52, 0x7f,  0x90, 0x52, 0x00 }, // 5.D2
  {  0x1011,  0,   0x90, 0x53, 0x7f,  0x90, 0x53, 0x00 }, // 5.D3
  {  0x1011,  0,   0x90, 0x54, 0x7f,  0x90, 0x54, 0x00 }, // 5.D4
  {  0x1011,  0,   0x90, 0x55, 0x7f,  0x90, 0x55, 0x00 }, // 5.D5
  {  0x1011,  0,   0x90, 0x56, 0x7f,  0x90, 0x56, 0x00 }, // 5.D6
  {  0x1011,  0,   0x90, 0x57, 0x7f,  0x90, 0x57, 0x00 }, // 5.D7

  // ports   mode     ON event           OFF event           SR/Pin
  {  0x1011,  0,   0x90, 0x58, 0x7f,  0x90, 0x58, 0x00 }, // 6.D0
  {  0x1011,  0,   0x90, 0x59, 0x7f,  0x90, 0x59, 0x00 }, // 6.D1
  {  0x1011,  0,   0x90, 0x5a, 0x7f,  0x90, 0x5a, 0x00 }, // 6.D2
  {  0x1011,  0,   0x90, 0x5b, 0x7f,  0x90, 0x5b, 0x00 }, // 6.D3
  {  0x1011,  0,   0x90, 0x5c, 0x7f,  0x90, 0x5c, 0x00 }, // 6.D4
  {  0x1011,  0,   0x90, 0x5d, 0x7f,  0x90, 0x5d, 0x00 }, // 6.D5
  {  0x1011,  0,   0x90, 0x5e, 0x7f,  0x90, 0x5e, 0x00 }, // 6.D6
  {  0x1011,  0,   0x90, 0x5f, 0x7f,  0x90, 0x5f, 0x00 }, // 6.D7

  // ports   mode     ON event           OFF event           SR/Pin
  {  0x1011,  0,   0x90, 0x60, 0x7f,  0x90, 0x60, 0x00 }, // 7.D0
  {  0x1011,  0,   0x90, 0x61, 0x7f,  0x90, 0x61, 0x00 }, // 7.D1
  {  0x1011,  0,   0x90, 0x62, 0x7f,  0x90, 0x62, 0x00 }, // 7.D2
  {  0x1011,  0,   0x90, 0x63, 0x7f,  0x90, 0x63, 0x00 }, // 7.D3
  {  0x1011,  0,   0x90, 0x64, 0x7f,  0x90, 0x64, 0x00 }, // 7.D4
  {  0x1011,  0,   0x90, 0x65, 0x7f,  0x90, 0x65, 0x00 }, // 7.D5
  {  0x1011,  0,   0x90, 0x66, 0x7f,  0x90, 0x66, 0x00 }, // 7.D6
  {  0x1011,  0,   0x90, 0x67, 0x7f,  0x90, 0x67, 0x00 }, // 7.D7

  // ports   mode     ON event           OFF event           SR/Pin
  {  0x1011,  0,   0x90, 0x68, 0x7f,  0x90, 0x68, 0x00 }, // 8.D0
  {  0x1011,  0,   0x90, 0x69, 0x7f,  0x90, 0x69, 0x00 }, // 8.D1
  {  0x1011,  0,   0x90, 0x6a, 0x7f,  0x90, 0x6a, 0x00 }, // 8.D2
  {  0x1011,  0,   0x90, 0x6b, 0x7f,  0x90, 0x6b, 0x00 }, // 8.D3
  {  0x1011,  0,   0x90, 0x6c, 0x7f,  0x90, 0x6c, 0x00 }, // 8.D4
  {  0x1011,  0,   0x90, 0x6d, 0x7f,  0x90, 0x6d, 0x00 }, // 8.D5
  {  0x1011,  0,   0x90, 0x6e, 0x7f,  0x90, 0x6e, 0x00 }, // 8.D6
  {  0x1011,  0,   0x90, 0x6f, 0x7f,  0x90, 0x6f, 0x00 }, // 8.D7

  // ports   mode     ON event           OFF event           SR/Pin
  {  0x1011,  0,   0xb0, 0x10, 0x7f,  0xb0, 0x10, 0x00 }, // 9.D0
  {  0x1011,  0,   0xb0, 0x11, 0x7f,  0xb0, 0x11, 0x00 }, // 9.D1
  {  0x1011,  0,   0xb0, 0x12, 0x7f,  0xb0, 0x12, 0x00 }, // 9.D2
  {  0x1011,  0,   0xb0, 0x13, 0x7f,  0xb0, 0x13, 0x00 }, // 9.D3
  {  0x1011,  0,   0xb0, 0x14, 0x7f,  0xb0, 0x14, 0x00 }, // 9.D4
  {  0x1011,  0,   0xb0, 0x15, 0x7f,  0xb0, 0x15, 0x00 }, // 9.D5
  {  0x1011,  0,   0xb0, 0x16, 0x7f,  0xb0, 0x16, 0x00 }, // 9.D6
  {  0x1011,  0,   0xb0, 0x17, 0x7f,  0xb0, 0x17, 0x00 }, // 9.D7

  // ports   mode     ON event           OFF event           SR/Pin
  {  0x1011,  0,   0xb0, 0x18, 0x7f,  0xb0, 0x18, 0x00 }, // 10.D0
  {  0x1011,  0,   0xb0, 0x19, 0x7f,  0xb0, 0x19, 0x00 }, // 10.D1
  {  0x1011,  0,   0xb0, 0x1a, 0x7f,  0xb0, 0x1a, 0x00 }, // 10.D2
  {  0x1011,  0,   0xb0, 0x1b, 0x7f,  0xb0, 0x1b, 0x00 }, // 10.D3
  {  0x1011,  0,   0xb0, 0x1c, 0x7f,  0xb0, 0x1c, 0x00 }, // 10.D4
  {  0x1011,  0,   0xb0, 0x1d, 0x7f,  0xb0, 0x1d, 0x00 }, // 10.D5
  {  0x1011,  0,   0xb0, 0x1e, 0x7f,  0xb0, 0x1e, 0x00 }, // 10.D6
  {  0x1011,  0,   0xb0, 0x1f, 0x7f,  0xb0, 0x1f, 0x00 }, // 10.D7

  // ports   mode     ON event           OFF event           SR/Pin
  {  0x1011,  0,   0xb0, 0x20, 0x7f,  0xb0, 0x20, 0x00 }, // 11.D0
  {  0x1011,  0,   0xb0, 0x21, 0x7f,  0xb0, 0x21, 0x00 }, // 11.D1
  {  0x1011,  0,   0xb0, 0x22, 0x7f,  0xb0, 0x22, 0x00 }, // 11.D2
  {  0x1011,  0,   0xb0, 0x23, 0x7f,  0xb0, 0x23, 0x00 }, // 11.D3
  {  0x1011,  0,   0xb0, 0x24, 0x7f,  0xb0, 0x24, 0x00 }, // 11.D4
  {  0x1011,  0,   0xb0, 0x25, 0x7f,  0xb0, 0x25, 0x00 }, // 11.D5
  {  0x1011,  0,   0xb0, 0x26, 0x7f,  0xb0, 0x26, 0x00 }, // 11.D6
  {  0x1011,  0,   0xb0, 0x27, 0x7f,  0xb0, 0x27, 0x00 }, // 11.D7

  // ports   mode     ON event           OFF event           SR/Pin
  {  0x1011,  0,   0xb0, 0x28, 0x7f,  0xb0, 0x28, 0x00 }, // 12.D0
  {  0x1011,  0,   0xb0, 0x29, 0x7f,  0xb0, 0x29, 0x00 }, // 12.D1
  {  0x1011,  0,   0xb0, 0x2a, 0x7f,  0xb0, 0x2a, 0x00 }, // 12.D2
  {  0x1011,  0,   0xb0, 0x2b, 0x7f,  0xb0, 0x2b, 0x00 }, // 12.D3
  {  0x1011,  0,   0xb0, 0x2c, 0x7f,  0xb0, 0x2c, 0x00 }, // 12.D4
  {  0x1011,  0,   0xb0, 0x2d, 0x7f,  0xb0, 0x2d, 0x00 }, // 12.D5
  {  0x1011,  0,   0xb0, 0x2e, 0x7f,  0xb0, 0x2e, 0x00 }, // 12.D6
  {  0x1011,  0,   0xb0, 0x2f, 0x7f,  0xb0, 0x2f, 0x00 }, // 12.D7

  // ports   mode     ON event           OFF event           SR/Pin
  {  0x1011,  0,   0xb0, 0x30, 0x7f,  0xb0, 0x30, 0x00 }, // 13.D0
  {  0x1011,  0,   0xb0, 0x31, 0x7f,  0xb0, 0x31, 0x00 }, // 13.D1
  {  0x1011,  0,   0xb0, 0x32, 0x7f,  0xb0, 0x32, 0x00 }, // 13.D2
  {  0x1011,  0,   0xb0, 0x33, 0x7f,  0xb0, 0x33, 0x00 }, // 13.D3
  {  0x1011,  0,   0xb0, 0x34, 0x7f,  0xb0, 0x34, 0x00 }, // 13.D4
  {  0x1011,  0,   0xb0, 0x35, 0x7f,  0xb0, 0x35, 0x00 }, // 13.D5
  {  0x1011,  0,   0xb0, 0x36, 0x7f,  0xb0, 0x36, 0x00 }, // 13.D6
  {  0x1011,  0,   0xb0, 0x37, 0x7f,  0xb0, 0x37, 0x00 }, // 13.D7

  // ports   mode     ON event           OFF event           SR/Pin
  {  0x1011,  0,   0xb0, 0x38, 0x7f,  0xb0, 0x38, 0x00 }, // 14.D0
  {  0x1011,  0,   0xb0, 0x39, 0x7f,  0xb0, 0x39, 0x00 }, // 14.D1
  {  0x1011,  0,   0xb0, 0x3a, 0x7f,  0xb0, 0x3a, 0x00 }, // 14.D2
  {  0x1011,  0,   0xb0, 0x3b, 0x7f,  0xb0, 0x3b, 0x00 }, // 14.D3
  {  0x1011,  0,   0xb0, 0x3c, 0x7f,  0xb0, 0x3c, 0x00 }, // 14.D4
  {  0x1011,  0,   0xb0, 0x3d, 0x7f,  0xb0, 0x3d, 0x00 }, // 14.D5
  {  0x1011,  0,   0xb0, 0x3e, 0x7f,  0xb0, 0x3e, 0x00 }, // 14.D6
  {  0x1011,  0,   0xb0, 0x3f, 0x7f,  0xb0, 0x3f, 0x00 }, // 14.D7

  // ports   mode     ON event           OFF event           SR/Pin
  {  0x1011,  0,   0xb0, 0x40, 0x7f,  0xb0, 0x40, 0x00 }, // 15.D0
  {  0x1011,  0,   0xb0, 0x41, 0x7f,  0xb0, 0x41, 0x00 }, // 15.D1
  {  0x1011,  0,   0xb0, 0x42, 0x7f,  0xb0, 0x42, 0x00 }, // 15.D2
  {  0x1011,  0,   0xb0, 0x43, 0x7f,  0xb0, 0x43, 0x00 }, // 15.D3
  {  0x1011,  0,   0xb0, 0x44, 0x7f,  0xb0, 0x44, 0x00 }, // 15.D4
  {  0x1011,  0,   0xb0, 0x45, 0x7f,  0xb0, 0x45, 0x00 }, // 15.D5
  {  0x1011,  0,   0xb0, 0x46, 0x7f,  0xb0, 0x46, 0x00 }, // 15.D6
  {  0x1011,  0,   0xb0, 0x47, 0x7f,  0xb0, 0x47, 0x00 }, // 15.D7

  // ports   mode     ON event           OFF event           SR/Pin
  {  0x1011,  0,   0xb0, 0x48, 0x7f,  0xb0, 0x48, 0x00 }, // 16.D0
  {  0x1011,  0,   0xb0, 0x49, 0x7f,  0xb0, 0x49, 0x00 }, // 16.D1
  {  0x1011,  0,   0xb0, 0x4a, 0x7f,  0xb0, 0x4a, 0x00 }, // 16.D2
  {  0x1011,  0,   0xb0, 0x4b, 0x7f,  0xb0, 0x4b, 0x00 }, // 16.D3
  {  0x1011,  0,   0xb0, 0x4c, 0x7f,  0xb0, 0x4c, 0x00 }, // 16.D4
  {  0x1011,  0,   0xb0, 0x4d, 0x7f,  0xb0, 0x4d, 0x00 }, // 16.D5
  {  0x1011,  0,   0xb0, 0x4e, 0x7f,  0xb0, 0x4e, 0x00 }, // 16.D6
  {  0x1011,  0,   0xb0, 0x4f, 0x7f,  0xb0, 0x4f, 0x00 }, // 16.D7
};

mbng_patch_enc_entry_t  mbng_patch_enc[MBNG_PATCH_NUM_ENC] = {
  // ports     min     max  mode event
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x00 }, //  1
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x01 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x02 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x03 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x04 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x05 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x06 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x07 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x08 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x09 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x0a },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x0b },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x0c },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x0d },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x0e },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x0f },

  // ports      min     max  mode event
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x10 }, // 17
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x11 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x12 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x13 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x14 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x15 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x16 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x17 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x18 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x19 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x1a },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x1b },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x1c },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x1d },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x1e },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x1f },

  // ports      min     max  mode event
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x20 }, // 33
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x21 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x22 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x23 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x24 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x25 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x26 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x27 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x28 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x29 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x2a },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x2b },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x2c },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x2d },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x2e },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x2f },

  // ports      min     max  mode event
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x30 }, // 49
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x31 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x32 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x33 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x34 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x35 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x36 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x37 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x38 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x39 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x3a },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x3b },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x3c },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x3d },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x3e },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x3f },

  // ports      min     max  mode event
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x40 }, // 65
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x41 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x42 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x43 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x44 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x45 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x46 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x47 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x48 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x49 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x4a },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x4b },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x4c },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x4d },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x4e },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x4f },

  // ports      min     max  mode event
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x50 }, // 81
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x51 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x52 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x53 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x54 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x55 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x56 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x57 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x58 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x59 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x5a },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x5b },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x5c },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x5d },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x5e },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x5f },

  // ports      min     max  mode event
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x60 }, // 97
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x61 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x62 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x63 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x64 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x65 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x66 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x67 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x68 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x69 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x6a },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x6b },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x6c },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x6d },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x6e },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x6f },

  // ports      min     max  mode event
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x70 }, // 113
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x71 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x72 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x73 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x74 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x75 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x76 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x77 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x78 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x79 },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x7a },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x7b },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x7c },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x7d },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x7e },
  {  0x1011, 0x0000, 0x007f,  1, 0xb0, 0x7f },

};

mbng_patch_dout_entry_t mbng_patch_dout[MBNG_PATCH_NUM_DOUT] = {
  // ports   event           SR/Pin
  {  0x1011, 0x90, 0x30 }, // 1.D7
  {  0x1011, 0x90, 0x31 }, // 1.D6
  {  0x1011, 0x90, 0x32 }, // 1.D5
  {  0x1011, 0x90, 0x33 }, // 1.D4
  {  0x1011, 0x90, 0x34 }, // 1.D3
  {  0x1011, 0x90, 0x35 }, // 1.D2
  {  0x1011, 0x90, 0x36 }, // 1.D1
  {  0x1011, 0x90, 0x37 }, // 1.D0

  // ports   event           SR/Pin
  {  0x1011, 0x90, 0x38 }, // 2.D7
  {  0x1011, 0x90, 0x39 }, // 2.D6
  {  0x1011, 0x90, 0x3a }, // 2.D5
  {  0x1011, 0x90, 0x3b }, // 2.D4
  {  0x1011, 0x90, 0x3c }, // 2.D3
  {  0x1011, 0x90, 0x3d }, // 2.D2
  {  0x1011, 0x90, 0x3e }, // 2.D1
  {  0x1011, 0x90, 0x3f }, // 2.D0

  // ports   event           SR/Pin
  {  0x1011, 0x90, 0x40 }, // 3.D7
  {  0x1011, 0x90, 0x41 }, // 3.D6
  {  0x1011, 0x90, 0x42 }, // 3.D5
  {  0x1011, 0x90, 0x43 }, // 3.D4
  {  0x1011, 0x90, 0x44 }, // 3.D3
  {  0x1011, 0x90, 0x45 }, // 3.D2
  {  0x1011, 0x90, 0x46 }, // 3.D1
  {  0x1011, 0x90, 0x47 }, // 3.D0

  // ports   event           SR/Pin
  {  0x1011, 0x90, 0x48 }, // 4.D7
  {  0x1011, 0x90, 0x49 }, // 4.D6
  {  0x1011, 0x90, 0x4a }, // 4.D5
  {  0x1011, 0x90, 0x4b }, // 4.D4
  {  0x1011, 0x90, 0x4c }, // 4.D3
  {  0x1011, 0x90, 0x4d }, // 4.D2
  {  0x1011, 0x90, 0x4e }, // 4.D1
  {  0x1011, 0x90, 0x4f }, // 4.D0

  // ports   event           SR/Pin
  {  0x1011, 0x90, 0x50 }, // 5.D7
  {  0x1011, 0x90, 0x51 }, // 5.D6
  {  0x1011, 0x90, 0x52 }, // 5.D5
  {  0x1011, 0x90, 0x53 }, // 5.D4
  {  0x1011, 0x90, 0x54 }, // 5.D3
  {  0x1011, 0x90, 0x55 }, // 5.D2
  {  0x1011, 0x90, 0x56 }, // 5.D1
  {  0x1011, 0x90, 0x57 }, // 5.D0

  // ports   event           SR/Pin
  {  0x1011, 0x90, 0x58 }, // 6.D7
  {  0x1011, 0x90, 0x59 }, // 6.D6
  {  0x1011, 0x90, 0x5a }, // 6.D5
  {  0x1011, 0x90, 0x5b }, // 6.D4
  {  0x1011, 0x90, 0x5c }, // 6.D3
  {  0x1011, 0x90, 0x5d }, // 6.D2
  {  0x1011, 0x90, 0x5e }, // 6.D1
  {  0x1011, 0x90, 0x5f }, // 6.D0

  // ports   event           SR/Pin
  {  0x1011, 0x90, 0x60 }, // 7.D7
  {  0x1011, 0x90, 0x61 }, // 7.D6
  {  0x1011, 0x90, 0x62 }, // 7.D5
  {  0x1011, 0x90, 0x63 }, // 7.D4
  {  0x1011, 0x90, 0x64 }, // 7.D3
  {  0x1011, 0x90, 0x65 }, // 7.D2
  {  0x1011, 0x90, 0x66 }, // 7.D1
  {  0x1011, 0x90, 0x67 }, // 7.D0

  // ports   event           SR/Pin
  {  0x1011, 0x90, 0x68 }, // 8.D7
  {  0x1011, 0x90, 0x69 }, // 8.D6
  {  0x1011, 0x90, 0x6a }, // 8.D5
  {  0x1011, 0x90, 0x6b }, // 8.D4
  {  0x1011, 0x90, 0x6c }, // 8.D3
  {  0x1011, 0x90, 0x6d }, // 8.D2
  {  0x1011, 0x90, 0x6e }, // 8.D1
  {  0x1011, 0x90, 0x6f }, // 8.D0

  // ports   event           SR/Pin
  {  0x1011, 0xb0, 0x10 }, // 9.D7
  {  0x1011, 0xb0, 0x11 }, // 9.D6
  {  0x1011, 0xb0, 0x12 }, // 9.D5
  {  0x1011, 0xb0, 0x13 }, // 9.D4
  {  0x1011, 0xb0, 0x14 }, // 9.D3
  {  0x1011, 0xb0, 0x15 }, // 9.D2
  {  0x1011, 0xb0, 0x16 }, // 9.D1
  {  0x1011, 0xb0, 0x17 }, // 9.D0

  // ports   event           SR/Pin
  {  0x1011, 0xb0, 0x18 }, // 10.D7
  {  0x1011, 0xb0, 0x19 }, // 10.D6
  {  0x1011, 0xb0, 0x1a }, // 10.D5
  {  0x1011, 0xb0, 0x1b }, // 10.D4
  {  0x1011, 0xb0, 0x1c }, // 10.D3
  {  0x1011, 0xb0, 0x1d }, // 10.D2
  {  0x1011, 0xb0, 0x1e }, // 10.D1
  {  0x1011, 0xb0, 0x1f }, // 10.D0

  // ports   event           SR/Pin
  {  0x1011, 0xb0, 0x20 }, // 11.D7
  {  0x1011, 0xb0, 0x21 }, // 11.D6
  {  0x1011, 0xb0, 0x22 }, // 11.D5
  {  0x1011, 0xb0, 0x23 }, // 11.D4
  {  0x1011, 0xb0, 0x24 }, // 11.D3
  {  0x1011, 0xb0, 0x25 }, // 11.D2
  {  0x1011, 0xb0, 0x26 }, // 11.D1
  {  0x1011, 0xb0, 0x27 }, // 11.D0

  // ports   event           SR/Pin
  {  0x1011, 0xb0, 0x28 }, // 12.D7
  {  0x1011, 0xb0, 0x29 }, // 12.D6
  {  0x1011, 0xb0, 0x2a }, // 12.D5
  {  0x1011, 0xb0, 0x2b }, // 12.D4
  {  0x1011, 0xb0, 0x2c }, // 12.D3
  {  0x1011, 0xb0, 0x2d }, // 12.D2
  {  0x1011, 0xb0, 0x2e }, // 12.D1
  {  0x1011, 0xb0, 0x2f }, // 12.D0

  // ports   event           SR/Pin
  {  0x1011, 0xb0, 0x30 }, // 13.D7
  {  0x1011, 0xb0, 0x31 }, // 13.D6
  {  0x1011, 0xb0, 0x32 }, // 13.D5
  {  0x1011, 0xb0, 0x33 }, // 13.D4
  {  0x1011, 0xb0, 0x34 }, // 13.D3
  {  0x1011, 0xb0, 0x35 }, // 13.D2
  {  0x1011, 0xb0, 0x36 }, // 13.D1
  {  0x1011, 0xb0, 0x37 }, // 13.D0

  // ports   event           SR/Pin
  {  0x1011, 0xb0, 0x38 }, // 14.D7
  {  0x1011, 0xb0, 0x39 }, // 14.D6
  {  0x1011, 0xb0, 0x3a }, // 14.D5
  {  0x1011, 0xb0, 0x3b }, // 14.D4
  {  0x1011, 0xb0, 0x3c }, // 14.D3
  {  0x1011, 0xb0, 0x3d }, // 14.D2
  {  0x1011, 0xb0, 0x3e }, // 14.D1
  {  0x1011, 0xb0, 0x3f }, // 14.D0

  // ports   event           SR/Pin
  {  0x1011, 0xb0, 0x40 }, // 15.D7
  {  0x1011, 0xb0, 0x41 }, // 15.D6
  {  0x1011, 0xb0, 0x42 }, // 15.D5
  {  0x1011, 0xb0, 0x43 }, // 15.D4
  {  0x1011, 0xb0, 0x44 }, // 15.D3
  {  0x1011, 0xb0, 0x45 }, // 15.D2
  {  0x1011, 0xb0, 0x46 }, // 15.D1
  {  0x1011, 0xb0, 0x47 }, // 15.D0

  // ports   event           SR/Pin
  {  0x1011, 0xb0, 0x48 }, // 16.D7
  {  0x1011, 0xb0, 0x49 }, // 16.D6
  {  0x1011, 0xb0, 0x4a }, // 16.D5
  {  0x1011, 0xb0, 0x4b }, // 16.D4
  {  0x1011, 0xb0, 0x4c }, // 16.D3
  {  0x1011, 0xb0, 0x4d }, // 16.D2
  {  0x1011, 0xb0, 0x4e }, // 16.D1
  {  0x1011, 0xb0, 0x4f }, // 16.D0
};

mbng_patch_ain_entry_t mbng_patch_ain[MBNG_PATCH_NUM_AIN] = {
  // ports   event           AIN Pin
  {  0x0000, 0xb0, 0x07 }, // 0
  {  0x0000, 0xb1, 0x07 }, // 1
  {  0x0000, 0xb2, 0x07 }, // 2
  {  0x0000, 0xb3, 0x07 }, // 3
  {  0x0000, 0xb4, 0x07 }, // 4
  {  0x0000, 0xb5, 0x07 }, // 5
#if MBNG_PATCH_NUM_AIN >= 7
  {  0x0000, 0xb6, 0x07 }, // 6
#endif
#if MBNG_PATCH_NUM_AIN >= 8
  {  0x0000, 0xb7, 0x07 }, // 7
#endif
};

mbng_patch_ain_entry_t mbng_patch_ainser[MBNG_PATCH_NUM_AINSER] = {
  // ports   event           AINSER Pin
  {  0x1011, 0xb0, 0x10 }, // 1_J6.A0
  {  0x1011, 0xb0, 0x11 }, // 1_J6.A1
  {  0x1011, 0xb0, 0x12 }, // 1_J6.A2
  {  0x1011, 0xb0, 0x13 }, // 1_J6.A3
  {  0x1011, 0xb0, 0x14 }, // 1_J6.A4
  {  0x1011, 0xb0, 0x15 }, // 1_J6.A5
  {  0x1011, 0xb0, 0x16 }, // 1_J6.A6
  {  0x1011, 0xb0, 0x17 }, // 1_J6.A7

  {  0x1011, 0xb0, 0x18 }, // 1_J7.A0
  {  0x1011, 0xb0, 0x19 }, // 1_J7.A1
  {  0x1011, 0xb0, 0x1a }, // 1_J7.A2
  {  0x1011, 0xb0, 0x1b }, // 1_J7.A3
  {  0x1011, 0xb0, 0x1c }, // 1_J7.A4
  {  0x1011, 0xb0, 0x1d }, // 1_J7.A5
  {  0x1011, 0xb0, 0x1e }, // 1_J7.A6
  {  0x1011, 0xb0, 0x1f }, // 1_J7.A7

  {  0x1011, 0xb0, 0x20 }, // 1_J8.A0
  {  0x1011, 0xb0, 0x21 }, // 1_J8.A1
  {  0x1011, 0xb0, 0x22 }, // 1_J8.A2
  {  0x1011, 0xb0, 0x23 }, // 1_J8.A3
  {  0x1011, 0xb0, 0x24 }, // 1_J8.A4
  {  0x1011, 0xb0, 0x25 }, // 1_J8.A5
  {  0x1011, 0xb0, 0x26 }, // 1_J8.A6
  {  0x1011, 0xb0, 0x27 }, // 1_J8.A7

  {  0x1011, 0xb0, 0x28 }, // 1_J9.A0
  {  0x1011, 0xb0, 0x29 }, // 1_J9.A1
  {  0x1011, 0xb0, 0x2a }, // 1_J9.A2
  {  0x1011, 0xb0, 0x2b }, // 1_J9.A3
  {  0x1011, 0xb0, 0x2c }, // 1_J9.A4
  {  0x1011, 0xb0, 0x2d }, // 1_J9.A5
  {  0x1011, 0xb0, 0x2e }, // 1_J9.A6
  {  0x1011, 0xb0, 0x2f }, // 1_J9.A7

  {  0x1011, 0xb0, 0x30 }, // 1_J10.A0
  {  0x1011, 0xb0, 0x31 }, // 1_J10.A1
  {  0x1011, 0xb0, 0x32 }, // 1_J10.A2
  {  0x1011, 0xb0, 0x33 }, // 1_J10.A3
  {  0x1011, 0xb0, 0x34 }, // 1_J10.A4
  {  0x1011, 0xb0, 0x35 }, // 1_J10.A5
  {  0x1011, 0xb0, 0x36 }, // 1_J10.A6
  {  0x1011, 0xb0, 0x37 }, // 1_J10.A7

  {  0x1011, 0xb0, 0x38 }, // 1_J11.A0
  {  0x1011, 0xb0, 0x39 }, // 1_J11.A1
  {  0x1011, 0xb0, 0x3a }, // 1_J11.A2
  {  0x1011, 0xb0, 0x3b }, // 1_J11.A3
  {  0x1011, 0xb0, 0x3c }, // 1_J11.A4
  {  0x1011, 0xb0, 0x3d }, // 1_J11.A5
  {  0x1011, 0xb0, 0x3e }, // 1_J11.A6
  {  0x1011, 0xb0, 0x3f }, // 1_J11.A7

  {  0x1011, 0xb0, 0x40 }, // 1_J12.A0
  {  0x1011, 0xb0, 0x41 }, // 1_J12.A1
  {  0x1011, 0xb0, 0x42 }, // 1_J12.A2
  {  0x1011, 0xb0, 0x43 }, // 1_J12.A3
  {  0x1011, 0xb0, 0x44 }, // 1_J12.A4
  {  0x1011, 0xb0, 0x45 }, // 1_J12.A5
  {  0x1011, 0xb0, 0x46 }, // 1_J12.A6
  {  0x1011, 0xb0, 0x47 }, // 1_J12.A7

  {  0x1011, 0xb0, 0x48 }, // 1_J13.A0
  {  0x1011, 0xb0, 0x49 }, // 1_J13.A1
  {  0x1011, 0xb0, 0x4a }, // 1_J13.A2
  {  0x1011, 0xb0, 0x4b }, // 1_J13.A3
  {  0x1011, 0xb0, 0x4c }, // 1_J13.A4
  {  0x1011, 0xb0, 0x4d }, // 1_J13.A5
  {  0x1011, 0xb0, 0x4e }, // 1_J13.A6
  {  0x1011, 0xb0, 0x4f }, // 1_J13.A7

  {  0x1011, 0xb1, 0x10 }, // 2_J6.A0
  {  0x1011, 0xb1, 0x11 }, // 2_J6.A1
  {  0x1011, 0xb1, 0x12 }, // 2_J6.A2
  {  0x1011, 0xb1, 0x13 }, // 2_J6.A3
  {  0x1011, 0xb1, 0x14 }, // 2_J6.A4
  {  0x1011, 0xb1, 0x15 }, // 2_J6.A5
  {  0x1011, 0xb1, 0x16 }, // 2_J6.A6
  {  0x1011, 0xb1, 0x17 }, // 2_J6.A7

  {  0x1011, 0xb1, 0x18 }, // 2_J7.A0
  {  0x1011, 0xb1, 0x19 }, // 2_J7.A1
  {  0x1011, 0xb1, 0x1a }, // 2_J7.A2
  {  0x1011, 0xb1, 0x1b }, // 2_J7.A3
  {  0x1011, 0xb1, 0x1c }, // 2_J7.A4
  {  0x1011, 0xb1, 0x1d }, // 2_J7.A5
  {  0x1011, 0xb1, 0x1e }, // 2_J7.A6
  {  0x1011, 0xb1, 0x1f }, // 2_J7.A7

  {  0x1011, 0xb1, 0x20 }, // 2_J8.A0
  {  0x1011, 0xb1, 0x21 }, // 2_J8.A1
  {  0x1011, 0xb1, 0x22 }, // 2_J8.A2
  {  0x1011, 0xb1, 0x23 }, // 2_J8.A3
  {  0x1011, 0xb1, 0x24 }, // 2_J8.A4
  {  0x1011, 0xb1, 0x25 }, // 2_J8.A5
  {  0x1011, 0xb1, 0x26 }, // 2_J8.A6
  {  0x1011, 0xb1, 0x27 }, // 2_J8.A7

  {  0x1011, 0xb1, 0x28 }, // 2_J9.A0
  {  0x1011, 0xb1, 0x29 }, // 2_J9.A1
  {  0x1011, 0xb1, 0x2a }, // 2_J9.A2
  {  0x1011, 0xb1, 0x2b }, // 2_J9.A3
  {  0x1011, 0xb1, 0x2c }, // 2_J9.A4
  {  0x1011, 0xb1, 0x2d }, // 2_J9.A5
  {  0x1011, 0xb1, 0x2e }, // 2_J9.A6
  {  0x1011, 0xb1, 0x2f }, // 2_J9.A7

  {  0x1011, 0xb1, 0x30 }, // 2_J10.A0
  {  0x1011, 0xb1, 0x31 }, // 2_J10.A1
  {  0x1011, 0xb1, 0x32 }, // 2_J10.A2
  {  0x1011, 0xb1, 0x33 }, // 2_J10.A3
  {  0x1011, 0xb1, 0x34 }, // 2_J10.A4
  {  0x1011, 0xb1, 0x35 }, // 2_J10.A5
  {  0x1011, 0xb1, 0x36 }, // 2_J10.A6
  {  0x1011, 0xb1, 0x37 }, // 2_J10.A7

  {  0x1011, 0xb1, 0x38 }, // 2_J11.A0
  {  0x1011, 0xb1, 0x39 }, // 2_J11.A1
  {  0x1011, 0xb1, 0x3a }, // 2_J11.A2
  {  0x1011, 0xb1, 0x3b }, // 2_J11.A3
  {  0x1011, 0xb1, 0x3c }, // 2_J11.A4
  {  0x1011, 0xb1, 0x3d }, // 2_J11.A5
  {  0x1011, 0xb1, 0x3e }, // 2_J11.A6
  {  0x1011, 0xb1, 0x3f }, // 2_J11.A7

  {  0x1011, 0xb1, 0x40 }, // 2_J12.A0
  {  0x1011, 0xb1, 0x41 }, // 2_J12.A1
  {  0x1011, 0xb1, 0x42 }, // 2_J12.A2
  {  0x1011, 0xb1, 0x43 }, // 2_J12.A3
  {  0x1011, 0xb1, 0x44 }, // 2_J12.A4
  {  0x1011, 0xb1, 0x45 }, // 2_J12.A5
  {  0x1011, 0xb1, 0x46 }, // 2_J12.A6
  {  0x1011, 0xb1, 0x47 }, // 2_J12.A7

  {  0x1011, 0xb1, 0x48 }, // 2_J13.A0
  {  0x1011, 0xb1, 0x49 }, // 2_J13.A1
  {  0x1011, 0xb1, 0x4a }, // 2_J13.A2
  {  0x1011, 0xb1, 0x4b }, // 2_J13.A3
  {  0x1011, 0xb1, 0x4c }, // 2_J13.A4
  {  0x1011, 0xb1, 0x4d }, // 2_J13.A5
  {  0x1011, 0xb1, 0x4e }, // 2_J13.A6
  {  0x1011, 0xb1, 0x4f }, // 2_J13.A7

};

mbng_patch_matrix_entry_t mbng_patch_matrix[MBNG_PATCH_NUM_MATRIX] = {
  // ports  matrix mode                     chn arg    DINSR  DOUTSR
  { 0x1011, MBNG_PATCH_MATRIX_MODE_COMMON,  1, 0x30,     0,     0 },
  { 0x1011, MBNG_PATCH_MATRIX_MODE_COMMON,  1, 0x30,     0,     0 },
  { 0x1011, MBNG_PATCH_MATRIX_MODE_COMMON,  1, 0x30,     0,     0 },
  { 0x1011, MBNG_PATCH_MATRIX_MODE_COMMON,  1, 0x30,     0,     0 },
  { 0x1011, MBNG_PATCH_MATRIX_MODE_COMMON,  1, 0x30,     0,     0 },
  { 0x1011, MBNG_PATCH_MATRIX_MODE_COMMON,  1, 0x30,     0,     0 },
  { 0x1011, MBNG_PATCH_MATRIX_MODE_COMMON,  1, 0x30,     0,     0 },
  { 0x1011, MBNG_PATCH_MATRIX_MODE_COMMON,  1, 0x30,     0,     0 },
  { 0x1011, MBNG_PATCH_MATRIX_MODE_COMMON,  1, 0x30,     0,     0 },
  { 0x1011, MBNG_PATCH_MATRIX_MODE_COMMON,  1, 0x30,     0,     0 },
  { 0x1011, MBNG_PATCH_MATRIX_MODE_COMMON,  1, 0x30,     0,     0 },
  { 0x1011, MBNG_PATCH_MATRIX_MODE_COMMON,  1, 0x30,     0,     0 },
  { 0x1011, MBNG_PATCH_MATRIX_MODE_COMMON,  1, 0x30,     0,     0 },
  { 0x1011, MBNG_PATCH_MATRIX_MODE_COMMON,  1, 0x30,     0,     0 },
  { 0x1011, MBNG_PATCH_MATRIX_MODE_COMMON,  1, 0x30,     0,     0 },
  { 0x1011, MBNG_PATCH_MATRIX_MODE_COMMON,  1, 0x30,     0,     0 },

  // Note: map_chn and map_evnt1 are initialized in MBNG_PATCH_Init()
};


mbng_patch_cfg_t mbng_patch_cfg = {
#if 0
  // TK: doesn't work, these values are initialized in PATCH_Init()
  .flags = { .MERGER_MODE = 0,
	     .ALT_PROGCHNG = 0,
	     .FORWARD_IO = 0,
	     .INVERSE_DIN = 0,
	     .INVERSE_DOUT = 0,
  },
#endif
  .debounce_ctr = 20,
  .global_chn = 0,
  .all_notes_off_chn = 0,
  .enc_group_size = 16,
};


/////////////////////////////////////////////////////////////////////////////
// This function initializes the patch structure
/////////////////////////////////////////////////////////////////////////////
s32 MBNG_PATCH_Init(u32 mode)
{
  if( mode != 0 )
    return -1; // only mode 0 supported

  // init remaining config values
  mbng_patch_cfg.flags.ALL = 0;
  mbng_patch_cfg.flags.FORWARD_IO = 1;
  mbng_patch_cfg.flags.INVERSE_DIN = 1;

  int matrix;
  mbng_patch_matrix_entry_t *m = (mbng_patch_matrix_entry_t *)&mbng_patch_matrix[0];
  for(matrix=0; matrix<MBNG_PATCH_NUM_MATRIX; ++matrix, ++m) {
    int i;
    for(i=0; i<64; ++i) {
      m->map_chn[i] = 1;
      m->map_evnt1[i] = 0x30 + i;
    }
  }

  return 0; // no error
}

/////////////////////////////////////////////////////////////////////////////
// This function loads the patch from SD Card
// Returns != 0 if Load failed
/////////////////////////////////////////////////////////////////////////////
s32 MBNG_PATCH_Load(char *filename)
{
  MUTEX_SDCARD_TAKE;
  s32 status = MBNG_FILE_P_Read(filename);
  MUTEX_SDCARD_GIVE;

  return status;
}


/////////////////////////////////////////////////////////////////////////////
// This function stores the patch on SD Card
// Returns != 0 if Store failed
/////////////////////////////////////////////////////////////////////////////
s32 MBNG_PATCH_Store(char *filename)
{
  MUTEX_SDCARD_TAKE;
  s32 status = MBNG_FILE_P_Write(filename);
  MUTEX_SDCARD_GIVE;

  return status;
}
