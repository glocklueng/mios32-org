// $Id$
/*
 * MIDI OSC Routines
 *
 * ==========================================================================
 *
 *  Copyright (C) 2008 Thorsten Klose (tk@midibox.org)
 *  Licensed for personal non-commercial use only.
 *  All other rights reserved.
 * 
 * ==========================================================================
 */

/////////////////////////////////////////////////////////////////////////////
// Include files
/////////////////////////////////////////////////////////////////////////////

#include <mios32.h>
#include <string.h>
#include "tasks.h"

#include "seq_midi_osc.h"


/////////////////////////////////////////////////////////////////////////////
// for optional debugging messages via DEBUG_MSG (defined in mios32_config.h)
/////////////////////////////////////////////////////////////////////////////
#define DEBUG_VERBOSE_LEVEL 0


/////////////////////////////////////////////////////////////////////////////
// Local prototypes
/////////////////////////////////////////////////////////////////////////////


/////////////////////////////////////////////////////////////////////////////
// Global variables
/////////////////////////////////////////////////////////////////////////////


/////////////////////////////////////////////////////////////////////////////
// Local variables
/////////////////////////////////////////////////////////////////////////////


/////////////////////////////////////////////////////////////////////////////
// Initialisation
/////////////////////////////////////////////////////////////////////////////
s32 SEQ_MIDI_OSC_Init(u32 mode)
{
  return 0; // no error
}


/////////////////////////////////////////////////////////////////////////////
// sends a MIDI packet as OSC datagram
/////////////////////////////////////////////////////////////////////////////
s32 SEQ_MIDI_OSC_SendPackage(u8 osc_port, mios32_midi_package_t package)
{
  // create the OSC packet
  u8 packet[128];
  u8 *end_ptr = packet;

  if( osc_port >= SEQ_MIDI_OSC_NUM_PORTS )
    return -1; // invalid port

  char midi_path[8];
  strcpy(midi_path, "/midiX");
  midi_path[5] = '1' + osc_port;
  end_ptr = MIOS32_OSC_PutString(end_ptr, midi_path);
  end_ptr = MIOS32_OSC_PutString(end_ptr, ",m");
  end_ptr = MIOS32_OSC_PutMIDI(end_ptr, package);

  // send packet and exit
  return OSC_SERVER_SendPacket(packet, (u32)(end_ptr-packet));
}
